:doctitle: Validation
:doccode: espd-tech-prod-018
:author: NPJ
:authoremail: nicole-anne.paterson-jones@ext.ec.europa.eu
:docdate: January 2024

== ISO Schematron

Schematron is a rule-based validation language that specifies validation processes against XML documents. ISO Schematron is an ISO (ISO/IEC 19757-3:2006) and open standard. Please visit the link:http://www.schematron.com/[ISO Schematron] web-site for the technical specification and details.

=== ESPD Business Rules

The ESPD-EDM uses Schematron to validate business rules, the business requirements taken as input for these rules are specified in the link:http://wiki.ds.unipi.gr/display/ESPDInt[ESPDint Business Document].

These business rules can be typified as:

[arabic]
. *Semantic validations*: e.g. The "cac:TenderingCriterionResponse" in a Response document MUST match one, and only one, of the "cac:TenderingCriterionProperty" elements in the XML instance of the corresponding ESPD-Request;
. *Assertions* about the presence or absence of patterns in XML documents: e.g. all business rules that apply to identifier nodes: mandatory attributes, structure of the identifier, etc.;
. *Code lists* validations: e.g. values and attributes for each code list element;
. *Other validations* that an XSD cannot do: e.g. Validates that one of the nodes has at least 1 child.

The following image shows different examples of validations:

image::https://kroki.io/pikchr/svg/eNqdVNtu2kAUfPdXHFl5SJrg7C4Y4zSNZC6p8tAQpWn6UKrKlzVsZbzIXgd467f00_olPTbYBoLktKwQsHjnzJmdOScJfABiMBFrgVzGmubQK_DkChI3AHOxAv1exq2BDDhEIlXQz1IR8zSFJIt4qoMnpvh4FIAvI5nAciYUh1BEEZAVuTU7tglLEagZUPPdSYLw7AoUXynQ__z6DWMvElNXCRmDkpClHGSM7wTmMuHAIz7nsUoh4AseByKe4t8g1YwnWA438oPpex2inxlSm2gbDmRFbTboDHDDVdibBR6P5BIcCudw2iKGeUHONKe9S-RpxuHFjTKeQigjfDoFFxauUjyJGwpQgxwv0Nkt4CiVCC9TZZlG0PZxUHMX9D6be6iFDGupFol8EQEPGvG7R_E1x3LLCte-51_dDXUoAVif9bsWAiwFXqixBARyKH624BQtZF4wg55piZjOFOJ4JU7qz5CcM-Wxv74bfqjxbmnfsQcHeJZr8A0gtYuOLb8EmuijL63B-FNr_DDRaxjLbg8ZPYTxShi2Ec4KSpib-mglyd5Rf59BkQvH4uV5Rqh1-QC0w1rMbpuMENKAWGnUJqgRM2uRwkrsy43aNw1yW3y_L22EeeVRJBYYHh0aXnqxjiPSAtHIMfvbGaDDc27WKhKYvDIUmMkQB0EA3jrfrt2mw0OGqfaLVKcwDkPho3Tfvm_W5eft11a5ky9j9_w4jtYgQsgFGUo_y439tF7wYgiJFCb602j4Y3A_0fFYMXuEcrHiK8N32z2r3y2n0ci8pbdD_KUOBOhg_-d5_3n7aGAtwsYgTOQc-vnN4WQaUQO31Ayn5NYOvSomcH2M6FtTUziiNkSvSk0-bZvT0qvSwlhh895OWpDTIw8HMlZbYo2p6R2kZtusXTeb03prlPebtKombe9Voj8-jr82srPdo-wo2af3zJMUvfev_LoVP0p2CBJmEEwFaWSHNA5GDiXVZdxsLNs0J0itP9lCBPsT4tBnTfMCORyI1mdluI_79lii9Dx3czcOXCWTtaH_b9QKuxZZs3IyfwEaPHCr[Non-code list business rules,width=600,height=300]
//image:Non-codelist_business_rules.jpg[Non-code list business rules,width=591,height=329]
//[Edit this diagram](https://niolesk.top/#https://kroki.io/pikchr/svg/eNqdVNtu2kAUfPdXHFl5SJrg7C4Y4zSNZC6p8tAQpWn6UKrKlzVsZbzIXgd467f00_olPTbYBoLktKwQsHjnzJmdOScJfABiMBFrgVzGmubQK_DkChI3AHOxAv1exq2BDDhEIlXQz1IR8zSFJIt4qoMnpvh4FIAvI5nAciYUh1BEEZAVuTU7tglLEagZUPPdSYLw7AoUXynQ__z6DWMvElNXCRmDkpClHGSM7wTmMuHAIz7nsUoh4AseByKe4t8g1YwnWA438oPpex2inxlSm2gbDmRFbTboDHDDVdibBR6P5BIcCudw2iKGeUHONKe9S-RpxuHFjTKeQigjfDoFFxauUjyJGwpQgxwv0Nkt4CiVCC9TZZlG0PZxUHMX9D6be6iFDGupFol8EQEPGvG7R_E1x3LLCte-51_dDXUoAVif9bsWAiwFXqixBARyKH624BQtZF4wg55piZjOFOJ4JU7qz5CcM-Wxv74bfqjxbmnfsQcHeJZr8A0gtYuOLb8EmuijL63B-FNr_DDRaxjLbg8ZPYTxShi2Ec4KSpib-mglyd5Rf59BkQvH4uV5Rqh1-QC0w1rMbpuMENKAWGnUJqgRM2uRwkrsy43aNw1yW3y_L22EeeVRJBYYHh0aXnqxjiPSAtHIMfvbGaDDc27WKhKYvDIUmMkQB0EA3jrfrt2mw0OGqfaLVKcwDkPho3Tfvm_W5eft11a5ky9j9_w4jtYgQsgFGUo_y439tF7wYgiJFCb602j4Y3A_0fFYMXuEcrHiK8N32z2r3y2n0ci8pbdD_KUOBOhg_-d5_3n7aGAtwsYgTOQc-vnN4WQaUQO31Ayn5NYOvSomcH2M6FtTUziiNkSvSk0-bZvT0qvSwlhh895OWpDTIw8HMlZbYo2p6R2kZtusXTeb03prlPebtKombe9Voj8-jr82srPdo-wo2af3zJMUvfev_LoVP0p2CBJmEEwFaWSHNA5GDiXVZdxsLNs0J0itP9lCBPsT4tBnTfMCORyI1mdluI_79lii9Dx3czcOXCWTtaH_b9QKuxZZs3IyfwEaPHCr)

The validation of code lists is explained in sections below.

=== Schematron Architecture

ISO Schematron executes the validations in two stages:

[arabic]
. *Design and implementation of the SCH files*. SCH stands for Schematron Schema and contains the set of rules to be validated within the XML document.
. *Execution of the implemented validations* in the SCH files:
[loweralpha]
.. Transformation of SCH files into XSLT files in order to be able to execute the validations against the XML.
.. Execution of the validations using the XSLT files to get the final report.

image::https://kroki.io/pikchr/svg/eNqtVV1v2jAUfc-vuIo6CQpEsSHtQNokSkGbRNVp8NCHvYRggqUQI8cZ6X79ru0ESCr6oQ2EhH19zzm-X76S8AV8j_LUWcWRSIRZF7PZxPd9xxmTEaxEATJcA9kX4C4m31zYMh5vFRAvuL6ScOBrtQVqFxbCL8iQTgYT2PAkOcKBE0opDtD76ozpCCIuo4RZ6EBju5e87_UXV-oMoN8QNskzJXb8D1u74D4t5r3lh-AG_6onaOj5yfbibQD45djwjYln_nR8j_AUt8sYt9Bg_7Y7CU8ZHur5Xl9nxh-BYoUCl7hInaxhxWPzs6SrJGcGHtG9FEKlOTLoQcvvYsLbGoJUEN8Xj1AGzW0tmdzxNFRCtl1EaNyhDklPkH0DSSvIp4d59qb7oOFOwxHYmPL0N8_4ChOyFocU-v4n2Eixs5fAk8WlkyR4cbSStIi2bBcqKVIYy2jLFYtULpl7FrULOkkZOoz9bdDFhiGo1tKXVARPKmECUjfQ0oBXdZyqRHR9lRlGlUUH3QpMPUVa0B9bFK2qKqADBLurfTIfpWHgrsvCgFRI3BcbjZk6zh2P70Rh67Ik-6x7tMZBB7Utg3vQwJoQErZRFeDBZMojXV2ARykrtuXpGg9UG1WN92d0RkChtQxtLMNnx5ljzWm9p7gd8HYV7q2vgWOB1zLjZMvCNU9jIDcB7qstSwGNw3PT0D-zkMtOddP74JoqApw7x7aj72y7-antsGimtDlS3foErQ_XV-epSX-AKUiw3Coa6g27pj6nlP4HJjuqakx7yX5zkWfIZzJn5kmgCfvHKYpcx0H6NjJ9Ce04y-lxljyEaR4myTOsWcbjVM_4BqiNtylcjLDH0Ltfef-QImJZBo-52ufqdVdqXAcN19d9-h4rSzgwKV5Ogw-MZqZBbKtaHILh6PaoTqEFuTeXhhDbjO_2CduxVGFjMcDHWEeTZZ4LZ2DIXzUVxdRYSTcfLVuNYhNsMcqHoiZgFaoIxxT6C1zifMJBxwoW5QqFYJb1mUyxfWbEx8x6bfBxSUDiAylVU_lNpXxgWP8CxFZ7nw==[Architecture for non-code list validation,width=600,height=300]
//image:Architecture_non-codelist_validation.jpg[Architecture for non-code list validation,width=567,height=284]
//[Edit this diagram](https://niolesk.top/#https://kroki.io/pikchr/svg/eNqtVV1v2jAUfc-vuIo6CQpEsSHtQNokSkGbRNVp8NCHvYRggqUQI8cZ6X79ru0ESCr6oQ2EhH19zzm-X76S8AV8j_LUWcWRSIRZF7PZxPd9xxmTEaxEATJcA9kX4C4m31zYMh5vFRAvuL6ScOBrtQVqFxbCL8iQTgYT2PAkOcKBE0opDtD76ozpCCIuo4RZ6EBju5e87_UXV-oMoN8QNskzJXb8D1u74D4t5r3lh-AG_6onaOj5yfbibQD45djwjYln_nR8j_AUt8sYt9Bg_7Y7CU8ZHur5Xl9nxh-BYoUCl7hInaxhxWPzs6SrJGcGHtG9FEKlOTLoQcvvYsLbGoJUEN8Xj1AGzW0tmdzxNFRCtl1EaNyhDklPkH0DSSvIp4d59qb7oOFOwxHYmPL0N8_4ChOyFocU-v4n2Eixs5fAk8WlkyR4cbSStIi2bBcqKVIYy2jLFYtULpl7FrULOkkZOoz9bdDFhiGo1tKXVARPKmECUjfQ0oBXdZyqRHR9lRlGlUUH3QpMPUVa0B9bFK2qKqADBLurfTIfpWHgrsvCgFRI3BcbjZk6zh2P70Rh67Ik-6x7tMZBB7Utg3vQwJoQErZRFeDBZMojXV2ARykrtuXpGg9UG1WN92d0RkChtQxtLMNnx5ljzWm9p7gd8HYV7q2vgWOB1zLjZMvCNU9jIDcB7qstSwGNw3PT0D-zkMtOddP74JoqApw7x7aj72y7-antsGimtDlS3foErQ_XV-epSX-AKUiw3Coa6g27pj6nlP4HJjuqakx7yX5zkWfIZzJn5kmgCfvHKYpcx0H6NjJ9Ce04y-lxljyEaR4myTOsWcbjVM_4BqiNtylcjLDH0Ltfef-QImJZBo-52ufqdVdqXAcN19d9-h4rSzgwKV5Ogw-MZqZBbKtaHILh6PaoTqEFuTeXhhDbjO_2CduxVGFjMcDHWEeTZZ4LZ2DIXzUVxdRYSTcfLVuNYhNsMcqHoiZgFaoIxxT6C1zifMJBxwoW5QqFYJb1mUyxfWbEx8x6bfBxSUDiAylVU_lNpXxgWP8CxFZ7nw==)

=== What does the SCH file contain?

[arabic]
. *Set of rules* specifying the context (the element(s) and/or attribute(s) which the assertions affect);
. Each rule have a *set of assertions* with the tests that must be evaluated in the context.

image::https://kroki.io/plantuml/svg/eNq9Vl1v2jAUfW5-hZU-0D4kTgTTBgpuC120SZ06rUyaNO3BOA6JcGxkOwVp9L_PCWEqBPeDffgpur733HPPta9zqTSWuiyYk-UJBakQeipWjprnfIElLsBPB4AxlslIyITKSZaTOadKgcDYR5jMZ1KUPBkLJiRYZrmmlb323dimzDgZWyy4fmx5cB4lISZBncmOuYt6GseBWRVKHUu-O1FqMgwKwYVaYEITFJHKdXDa6_Z7VzGKLlYFA_dUqlzwoRv6gQsoJyLJ-Wzofp3E3jv3AkWwjkJ2uLDbjd8bOEUyWuCtP9hux-Hoqj9GJhdXw-3udvN69KYXBMjNtF4MIFyUkvmCMOILOYOJShjcoGopuNuCbgqpoQcrxfbRm9TPZV0ul_6yW6cM-_0-_HZ3AycSc5UKWbj7wU25TwjTtpzsa7XAWlPJ_6dYDXSeWHFHX7zx7SfvdvLhiKIbT1l9ThHYWesITpEFMpIlozayxCShK21lTKZkAD5LkeaMfrz-l6xfHnpH9W5oq_lYKSq1rWZNlb3gSo2z82Gn54cda4tThmdWhBRrzI48HeZkeMFbLwifVbqx15MNdao2_e5SBxSl0qBUFOiMgnvMSroXttV0XYsp0uMaYQIPN2LDyjUauuBshxsYgo7tnNZEvYrMYekUZZTYO-fva9bgwtbFaEQ7921M4OYAIYtqL1hrsIEwg18dI251Z9XBa_0KEn--jryhrdAT3_f_4kSDlTxP8GoNBNg8B694bJtRj5wfziXliflf-QV3ibFn[SCH file example,width=700,height=180]
//image:SCH_file_example.jpg[SCH file example,width=617,height=194]
//[Edit this diagram](https://niolesk.top/#https://kroki.io/plantuml/svg/eNq9Vl1v2jAUfW5-hZU-0D4kTgTTBgpuC120SZ06rUyaNO3BOA6JcGxkOwVp9L_PCWEqBPeDffgpur733HPPta9zqTSWuiyYk-UJBakQeipWjprnfIElLsBPB4AxlslIyITKSZaTOadKgcDYR5jMZ1KUPBkLJiRYZrmmlb323dimzDgZWyy4fmx5cB4lISZBncmOuYt6GseBWRVKHUu-O1FqMgwKwYVaYEITFJHKdXDa6_Z7VzGKLlYFA_dUqlzwoRv6gQsoJyLJ-Wzofp3E3jv3AkWwjkJ2uLDbjd8bOEUyWuCtP9hux-Hoqj9GJhdXw-3udvN69KYXBMjNtF4MIFyUkvmCMOILOYOJShjcoGopuNuCbgqpoQcrxfbRm9TPZV0ul_6yW6cM-_0-_HZ3AycSc5UKWbj7wU25TwjTtpzsa7XAWlPJ_6dYDXSeWHFHX7zx7SfvdvLhiKIbT1l9ThHYWesITpEFMpIlozayxCShK21lTKZkAD5LkeaMfrz-l6xfHnpH9W5oq_lYKSq1rWZNlb3gSo2z82Gn54cda4tThmdWhBRrzI48HeZkeMFbLwifVbqx15MNdao2_e5SBxSl0qBUFOiMgnvMSroXttV0XYsp0uMaYQIPN2LDyjUauuBshxsYgo7tnNZEvYrMYekUZZTYO-fva9bgwtbFaEQ7921M4OYAIYtqL1hrsIEwg18dI251Z9XBa_0KEn--jryhrdAT3_f_4kSDlTxP8GoNBNg8B694bJtRj5wfziXliflf-QV3ibFn)

=== Execution

As a basis of the implementation, it has been taken into account:

[arabic]
. Schematron "skeleton" implementation in link:https://github.com/SCHEMATRON[XSLT].

image::https://kroki.io/pikchr/svg/eNq1k0Fu2zAQRfc8xUDIIk5tgZTtuDaahWLEaAB3pS66MGDQFi2xpciAZCAve5YcLSfpUFQcpwVSoEA3AsUR__z3h7qwcAM0zaQmpWk1ITlbgBdHD8nXWjrYJHkB98UmgR13-C71Xj2WwiWgvj86T_Ls5fPnn0_wrVjDQSrhwBvwlmt3MLZZ9B_DhuyNMhbokc2z5WSJG9yH7rATyrSQMxjB5Qg3hjSlAzQzPlcvlp-DLjb5m-D1q-AHuKTpdBjUyBrZlNQCDtY0kI9T0fVjKRuGpnSA5yuD5ydXFxZqwUupK8imU9z3tdCAxey8xD7Ss9K7534rMvpvoniOEG4twr1CdIyY2SDEs-6YkYcNIezUUscHISvkD-OBpMtwZ1TZB-UartSbZwy2sgJttLL0NTqZRyeyqj1gaOFtQ1qJtRRDxeTXLCx6OxA8YOxxgF-Ec7wSo2Jfi4Z7a_TIC9tIzb2x6dGpBKJSG4RWLM4mUCDEy5Sz2eRuNkOQ7D-DYH_Xg8w7kPH4RCKd2boTxdb9EEp4XOBV3yKHZ3_SZO_S5BZx4ky7QSWfUGAhmwdjfRLHHPxA-EHjVekuh-3s48RRvj37FXrZaPaNFFrBXqf-89vr1Yz-AvghLqo=[Execution files,width=600,height=150]
//image:Execution_files.jpg[Execution files,width=568,height=140]
//[Edit this diagram](https://niolesk.top/#https://kroki.io/pikchr/svg/eNq1k0Fu2zAQRfc8xUDIIk5tgZTtuDaahWLEaAB3pS66MGDQFi2xpciAZCAve5YcLSfpUFQcpwVSoEA3AsUR__z3h7qwcAM0zaQmpWk1ITlbgBdHD8nXWjrYJHkB98UmgR13-C71Xj2WwiWgvj86T_Ls5fPnn0_wrVjDQSrhwBvwlmt3MLZZ9B_DhuyNMhbokc2z5WSJG9yH7rATyrSQMxjB5Qg3hjSlAzQzPlcvlp-DLjb5m-D1q-AHuKTpdBjUyBrZlNQCDtY0kI9T0fVjKRuGpnSA5yuD5ydXFxZqwUupK8imU9z3tdCAxey8xD7Ss9K7534rMvpvoniOEG4twr1CdIyY2SDEs-6YkYcNIezUUscHISvkD-OBpMtwZ1TZB-UartSbZwy2sgJttLL0NTqZRyeyqj1gaOFtQ1qJtRRDxeTXLCx6OxA8YOxxgF-Ec7wSo2Jfi4Z7a_TIC9tIzb2x6dGpBKJSG4RWLM4mUCDEy5Sz2eRuNkOQ7D-DYH_Xg8w7kPH4RCKd2boTxdb9EEp4XOBV3yKHZ3_SZO_S5BZx4ky7QSWfUGAhmwdjfRLHHPxA-EHjVekuh-3s48RRvj37FXrZaPaNFFrBXqf-89vr1Yz-AvghLqo=)

This example describes the execution of the validation process using the link:http://saxon.sourceforge.net/[Saxon library] to execute XSLT files and the XSLT provided as a basis:

image::https://kroki.io/pikchr/svg/eNrNVF1r2zAUffevuJg-rEstLNnulsAGqTuzjZRBU8Ye9qI4qq3NkYoslvz8Xfkj2FlIA-tgGBvke3Tuufdc6cLAOwgJk8rzMjqDR1kJ8JfpRx9WulpDveFVNfrmutIGVhXPf8JWrm2J26evLwyUQhalBUoiXHlW7Ow5ROGOxfGHtyFwCxn1uDF6C7aUCoL33pzNIJcmd5r8IxSIQxU9EZ2yNE5dCRWuslv34MoekGasL_PbcvGMusIIoU6VeaA3_hd6r_d67xbPdvOGRUkUnZLsZdHLNQC-e1uJMaKcgXNGagjgVXgVkugSM8V9ps_8F_977ftsdTMuDLNOBtmSF23UQWnxuLRuvvlOK_KDG__4UI_1xkR1--5EXfNCBMu8FBtujVaBFWYjFbfakF1d-aeOykhYFpG6Y70XT9rYGXxafoHl1_vFWSSttGuU5s2NwSugnb5HozeOW4HVra9uHh2EjSGuLy1E7SHRcUg8gMRjSNIlivtE3gNKacuinZcrWTTv8Ab6oxWNR8S5xNClB9aTsLNJkkOSBSqppBLd8TV8DTR52nXKKVHbFk-vAvxcIl2hW0Qp-FqqAliS4F9b4lHC0Jt21NoQbazoQzQcxqbh4a4JRANaF-5dnaY3Kb2FvNK1gJXAFq7BOYHy2Sn5zMmfNOUmTb3_l_zfCjYAGw==[Execution of the validation process,width=550,height=300]
//image:Execution_validation_process.jpg[Execution of the validation process,width=528,height=284]
//[Edit this diagram](https://niolesk.top/#https://kroki.io/pikchr/svg/eNrNVF1r2zAUffevuJg-rEstLNnulsAGqTuzjZRBU8Ye9qI4qq3NkYoslvz8Xfkj2FlIA-tgGBvke3Tuufdc6cLAOwgJk8rzMjqDR1kJ8JfpRx9WulpDveFVNfrmutIGVhXPf8JWrm2J26evLwyUQhalBUoiXHlW7Ow5ROGOxfGHtyFwCxn1uDF6C7aUCoL33pzNIJcmd5r8IxSIQxU9EZ2yNE5dCRWuslv34MoekGasL_PbcvGMusIIoU6VeaA3_hd6r_d67xbPdvOGRUkUnZLsZdHLNQC-e1uJMaKcgXNGagjgVXgVkugSM8V9ps_8F_977ftsdTMuDLNOBtmSF23UQWnxuLRuvvlOK_KDG__4UI_1xkR1--5EXfNCBMu8FBtujVaBFWYjFbfakF1d-aeOykhYFpG6Y70XT9rYGXxafoHl1_vFWSSttGuU5s2NwSugnb5HozeOW4HVra9uHh2EjSGuLy1E7SHRcUg8gMRjSNIlivtE3gNKacuinZcrWTTv8Ab6oxWNR8S5xNClB9aTsLNJkkOSBSqppBLd8TV8DTR52nXKKVHbFk-vAvxcIl2hW0Qp-FqqAliS4F9b4lHC0Jt21NoQbazoQzQcxqbh4a4JRANaF-5dnaY3Kb2FvNK1gJXAFq7BOYHy2Sn5zMmfNOUmTb3_l_zfCjYAGw==)


== Code list validation Architecture

Business rules related to code list validates:

image::https://kroki.io/pikchr/svg/eNqVls9zmzoQx-_8FTtMD03TUATGxOmPGbDdTi6vM22mp14wyLZSDB6BYzun_gE9vuPrpX_a-0u6AglsNS4mM4mJ0fezu9rVrp5xeAu25bDMSPJtZhgBuYFZvgMeJeCtd2CO84RCyooSwk3BMloUwDcpLUyYsQUuTROI8zTnsF2yksKcpSnYO_u9Nxh5sGVJuQTivXjGEe3cQEl3JZifaBqVLM9gRsstpRkQZCgzUZYAeXUJNKUrmpXFjQnp_QZffDVqQ_aOjJzxYIxfRCU67yEmzbcQELiE51fE8l7aF0bgKmv_f_8Fd0uqgGgqKyOWFZBnFPI5lPjuIUo3tFD_ceEfTVqnXnf5cK374FQ-DA59CMqSs9mmbO2oECHitPoCPSqgWNOYzRlNrL9bJRZ50qoR-JGy-8YEJXVCJxz6KN0yzIm1BUQEBD-v4Ln9EnftwuBssSxRPlPycb7JSr5vIcOJY5OpBvEji1YUiwyqsP1YAcTmBQuaxfvbSUsJbdd1bZ0yayh1Av1EUd5-NTvi8GNdTJX49vPHVuyP3IlDdHHSiOu0-XMl7jZMG61daxeHsX-hvMBC7w5-rruw7BH8ohH7tZgpsWPZrbgpniPxshETIVY1cH_-FrBjQuB_O9yCf6IV7Yr-XhHsUU1Ie0T_TU_96iD14JLh8Ip0bUKqM7Lzw1_p2lxp33VJM33n1o3rd11Fm-vaXXPoX3XZXevafc8Tv9PL9fHsmPfHto1QThwTTvxIl8Qgutuv6allJhSrCIdPNZLk4HFw8MCSipIGIp5rT7KmbxWy_dnW8AI7MI7B0JHuyLaVYIMW3ZjrfDF5XoTYQPER8fiEfw_5-A3i5UCckGkwndYmKnzVlmpigSfECF1pV7aM_uYcYY5lD6xgs1QAI0kkogkcmhrIF5-XOZfns68x92-xHWTsz_2rXMCsq7Rr6X0ijd7TWZRJfMR6uhT1hKcPh5jMImnSOFFEEQyabYN6ImOnUhYSlZ5g2oen54SorQ_e98G4J93yFO9DH95Ad2uoMLd9MN5Jt3zJsyzrj9rqog51564lTPTE853zTzo3UsF-7MO7PnbLGGMBx4zHKcXWY6qOYzltgcZqPMbG2Dlz8Vosds9ajAdcLB6ctxj9jw0j4hzvi3Oer2CMtQ5lDmPXotXO4C315w8Toln-gFfg6uJZXfHVb3vV5zQ5ImGV0wo1ELslWf_9q1gnKAuOV3_D-A0izaAt[Code list business rules,width=650,height=350]
//image:Codelist_business_rules.jpg[Code list business rules,width=600,height=325]
//[Edit this diagram](https://niolesk.top/#https://kroki.io/pikchr/svg/eNqVls9zmzoQx-_8FTtMD03TUATGxOmPGbDdTi6vM22mp14wyLZSDB6BYzun_gE9vuPrpX_a-0u6AglsNS4mM4mJ0fezu9rVrp5xeAu25bDMSPJtZhgBuYFZvgMeJeCtd2CO84RCyooSwk3BMloUwDcpLUyYsQUuTROI8zTnsF2yksKcpSnYO_u9Nxh5sGVJuQTivXjGEe3cQEl3JZifaBqVLM9gRsstpRkQZCgzUZYAeXUJNKUrmpXFjQnp_QZffDVqQ_aOjJzxYIxfRCU67yEmzbcQELiE51fE8l7aF0bgKmv_f_8Fd0uqgGgqKyOWFZBnFPI5lPjuIUo3tFD_ceEfTVqnXnf5cK374FQ-DA59CMqSs9mmbO2oECHitPoCPSqgWNOYzRlNrL9bJRZ50qoR-JGy-8YEJXVCJxz6KN0yzIm1BUQEBD-v4Ln9EnftwuBssSxRPlPycb7JSr5vIcOJY5OpBvEji1YUiwyqsP1YAcTmBQuaxfvbSUsJbdd1bZ0yayh1Av1EUd5-NTvi8GNdTJX49vPHVuyP3IlDdHHSiOu0-XMl7jZMG61daxeHsX-hvMBC7w5-rruw7BH8ohH7tZgpsWPZrbgpniPxshETIVY1cH_-FrBjQuB_O9yCf6IV7Yr-XhHsUU1Ie0T_TU_96iD14JLh8Ip0bUKqM7Lzw1_p2lxp33VJM33n1o3rd11Fm-vaXXPoX3XZXevafc8Tv9PL9fHsmPfHto1QThwTTvxIl8Qgutuv6allJhSrCIdPNZLk4HFw8MCSipIGIp5rT7KmbxWy_dnW8AI7MI7B0JHuyLaVYIMW3ZjrfDF5XoTYQPER8fiEfw_5-A3i5UCckGkwndYmKnzVlmpigSfECF1pV7aM_uYcYY5lD6xgs1QAI0kkogkcmhrIF5-XOZfns68x92-xHWTsz_2rXMCsq7Rr6X0ijd7TWZRJfMR6uhT1hKcPh5jMImnSOFFEEQyabYN6ImOnUhYSlZ5g2oen54SorQ_e98G4J93yFO9DH95Ad2uoMLd9MN5Jt3zJsyzrj9rqog51564lTPTE853zTzo3UsF-7MO7PnbLGGMBx4zHKcXWY6qOYzltgcZqPMbG2Dlz8Vosds9ajAdcLB6ctxj9jw0j4hzvi3Oer2CMtQ5lDmPXotXO4C315w8Toln-gFfg6uJZXfHVb3vV5zQ5ImGV0wo1ELslWf_9q1gnKAuOV3_D-A0izaAt)

=== Architecture for Code List validation

The validation of the code lists needs an extra step on the process before executing the Schematron process. This is because it needs link:https://www.oasis-open.org/committees/tc_home.php?wg_abbrev=codelist[Genericode] (GC) as input files.

[arabic]
. The first step is the *generation of Genericode (GC) files*. These files contains information about the values and identifiers of each code list.
[loweralpha]
.. GC files are found in the link:{url-tree}/codelists/gc/[/codelists/gc folder].
. *Design and implementation of the CVA files*. link:http://docs.oasis-open.org/codelist/ns/ContextValueAssociation/1.0/[CVA] stands for Context and Value Association:
. *Execution of the implemented validations* in the CVA files:
[loweralpha]
.. Transformation of CVA files into SCH files.
.. Continue with the Schematron execution process: (1) transformation of SCH files into XSLT and execution of the validations using the XSLT files to get the final report.


image::https://kroki.io/pikchr/svg/eNqtVl1vmzAUfedXXKE9hLVBYCBJJ21SkrXbpEydlmraw14IcYglgiNj1nS_ftfGkEC6pB9rVAm4Puce3y_7jYD34LmE5dYiTXjG9fvu5mbqeZ5ljf13kDCRZBREvAQ_2u7AtqFa6O38KzINp7BiWaZAH9UP36QVC8Hvof_BGpPXEgTvYMF3FVqBpz_GNqwpS9cSfDd6-0bAPVvKNZDq5R_UekNwwBu-Upg1jjrK5tPPL1FWcR8oG7w2ZMNuyMpC8g37Q5c22D_ns_7ds-hGr9Vz1dHznW75eQL4ZVXhGw9d_XDhuT7L8bOJcQ8N1aNzkbGc4qK-5waWNcGqlXQnwfZt9JwtYcFS_V_5XGQl1exI7uYQSxj7bgF96Cl8dIl-HGtCahLyVJKgIvGQwBtGjmqfRsnP2fxoy49KUOjAQWjj_9P0DJJ0kEGN_DK_BZNvu_e9zGjhnKEKO1Tho1R3VGxYHksuzvENOnxRE4-vs-IMdtTCWncTf1ejb_PsAVZc9dSSIs8-LadDhPkdRpc48EYO8pGGb56s6SaWgucwFsmaSZrIUtAnEPthhxlLx5T-SvANLvBxpeQ6v20DMQbSNQTGEHYNoTEMuobIGDBkltX0mupU0yt6AP2yQP1VXdVbskL2UNX9JSqgDlwAwUXOfpXe5L3apekuyLnAj3ylNoMWlRyXmPQ80Ss2SfX0Ind93yWRcThh6YTv_Gq2GIejk9sMzTb1OH7Us6_wGV3JvdcLnVtfOY0azIKuWb7EFfWHenqN1A8kWk3ZpCJ-qLWSllaj34ywtmrSjpwSqPXVGNoVEnWFBDfkxj8WMsN4qfDuS03vUG1QVbCndphyLGMtYE3jJctT8AeKX65pDmhEUMt65R0YTyK7xhezRhjSZsoFT5zPs_2ExfK5Jn7nWLLbx3X7JD95rUByVIjJyLAlazeRcnNNyH_wUp2JLS9bQX8zXhboS-dPTUkSKYdBc1yjr6YjzzOTY2ocutfNMfQ1zss4w7mLE5elubpMdEgPChWj61JEN0n6JnhCiwJuS7kt5Wko0dCwAz2NCbAnqkLWcbcm4TPuAHTfW8TwXOKoGTqWOYFpTkUsGR4POBf0G1MnD_Q-TR0VS1q4NhxyhXVfqfGo9UTPvU5MQpPbiqECf9Sxhxh7nm22Gd3QXGKXU8Br8aNCoiMhg-f2DXIcC_nS8r6IZYKzFuEcX3G24mFEdzQpJarASlNrCkm3hVae0gq1wjtEBgJvg0J2ZA9q2VHl9C9LG5sM[Architecture for code list validation,width=750,height=350]
//image:Architecture_codelist_validation.jpg[Architecture for code list validation,width=750,height=350]
//[Edit this diagram](https://niolesk.top/#https://kroki.io/pikchr/svg/eNqtVl1vmzAUfedXXKE9hLVBYCBJJ21SkrXbpEydlmraw14IcYglgiNj1nS_ftfGkEC6pB9rVAm4Puce3y_7jYD34LmE5dYiTXjG9fvu5mbqeZ5ljf13kDCRZBREvAQ_2u7AtqFa6O38KzINp7BiWaZAH9UP36QVC8Hvof_BGpPXEgTvYMF3FVqBpz_GNqwpS9cSfDd6-0bAPVvKNZDq5R_UekNwwBu-Upg1jjrK5tPPL1FWcR8oG7w2ZMNuyMpC8g37Q5c22D_ns_7ds-hGr9Vz1dHznW75eQL4ZVXhGw9d_XDhuT7L8bOJcQ8N1aNzkbGc4qK-5waWNcGqlXQnwfZt9JwtYcFS_V_5XGQl1exI7uYQSxj7bgF96Cl8dIl-HGtCahLyVJKgIvGQwBtGjmqfRsnP2fxoy49KUOjAQWjj_9P0DJJ0kEGN_DK_BZNvu_e9zGjhnKEKO1Tho1R3VGxYHksuzvENOnxRE4-vs-IMdtTCWncTf1ejb_PsAVZc9dSSIs8-LadDhPkdRpc48EYO8pGGb56s6SaWgucwFsmaSZrIUtAnEPthhxlLx5T-SvANLvBxpeQ6v20DMQbSNQTGEHYNoTEMuobIGDBkltX0mupU0yt6AP2yQP1VXdVbskL2UNX9JSqgDlwAwUXOfpXe5L3apekuyLnAj3ylNoMWlRyXmPQ80Ss2SfX0Ind93yWRcThh6YTv_Gq2GIejk9sMzTb1OH7Us6_wGV3JvdcLnVtfOY0azIKuWb7EFfWHenqN1A8kWk3ZpCJ-qLWSllaj34ywtmrSjpwSqPXVGNoVEnWFBDfkxj8WMsN4qfDuS03vUG1QVbCndphyLGMtYE3jJctT8AeKX65pDmhEUMt65R0YTyK7xhezRhjSZsoFT5zPs_2ExfK5Jn7nWLLbx3X7JD95rUByVIjJyLAlazeRcnNNyH_wUp2JLS9bQX8zXhboS-dPTUkSKYdBc1yjr6YjzzOTY2ocutfNMfQ1zss4w7mLE5elubpMdEgPChWj61JEN0n6JnhCiwJuS7kt5Wko0dCwAz2NCbAnqkLWcbcm4TPuAHTfW8TwXOKoGTqWOYFpTkUsGR4POBf0G1MnD_Q-TR0VS1q4NhxyhXVfqfGo9UTPvU5MQpPbiqECf9Sxhxh7nm22Gd3QXGKXU8Br8aNCoiMhg-f2DXIcC_nS8r6IZYKzFuEcX3G24mFEdzQpJarASlNrCkm3hVae0gq1wjtEBgJvg0J2ZA9q2VHl9C9LG5sM)


=== What does the SCH file contain?

[arabic]
. Association between one or more elements of the XML and one or more code list (specified in the Genericodes).
. The declaration of which attributes of the XML identify information of the Genericode.

The implementation of the CVA file has the following structure:

image::https://kroki.io/plantuml/svg/eNq1Vt1q2zAUvq6f4pBdZIPFatPSUpOZNqYtgxbCKGMwdqFKJ46oLQVJ6RLKYM-yR9uT7NhJSpZMjbu2ugjO8ZG-7_x8Rz5xnls_KYvI3So95paXILiVcB8B9Lm4za2ZaJmZwlj4PlIeK7uxEu3clluckencaD833BS0iywDLqXSOezS8xW3udL0-CNawZn7W5RRVEPWP1-jaC-GgcWhmqIDMwQ_QvhydQl0QI0L3kDJbxECqzckLklptHFjLlCmPVEBJd1-t394RP_ueJKRC079Z15M8NQ5IxT3yugeq13THqvOSIk50RuiRS2IC-FWXLDAErV30HCF-Lw52D8-OD1Pp2WhXUKsHtAX78_3-qfHWfphzd7PDve7R2lr5P04YUwa4WLDnXIdM0YdG5uTv8RCOc-0Y4FQ2V68y1rrAUcxrSiCJ6-dem1LfU3ikoi5dB25G0P1oir4BWq0qooBhqpA1wi7MfQSGNbSTGVIlAwlu6_k9WyMLQgUaWJVaGscs1ywxQGdjMKqaMS5aK1tWFBlq-33KmVgj9ThlTtg0Y2buP8L2BTx-XiNUJf9QMPPonOhnhBcJNeoaZrRiMwsjVVLmhxYUrD1MyZuRHI2HaPwKKuG2dDpfgyLuJKXZn5X9YbbpoPl6wdGO79__oJPWNTDpVIxcjGCiwy4loGx2ah8V5RFnmO6xqe-ZdKPmtgqCTXnBNr_FlTPiVFSu3SIV0DAjvgJH9RwUKvtvwgN6UJbCTbUdHSVVTfaW7vMl070u_fP1dicQvuJvdWOA1ljG6lfLfWZtRRrOXeJn6afrfNp0dvpS4m2Ya-x4HR61rjYCvvIF8kmk2_RCRWXvtj-AKpiukg=[CVA example,width=600,height=250]
//image:CVA_example.jpg[CVA example,width=600,height=258]
//[Edit this diagram](https://niolesk.top/#https://kroki.io/plantuml/svg/eNq1Vt1q2zAUvq6f4pBdZIPFatPSUpOZNqYtgxbCKGMwdqFKJ46oLQVJ6RLKYM-yR9uT7NhJSpZMjbu2ugjO8ZG-7_x8Rz5xnls_KYvI3So95paXILiVcB8B9Lm4za2ZaJmZwlj4PlIeK7uxEu3clluckencaD833BS0iywDLqXSOezS8xW3udL0-CNawZn7W5RRVEPWP1-jaC-GgcWhmqIDMwQ_QvhydQl0QI0L3kDJbxECqzckLklptHFjLlCmPVEBJd1-t394RP_ueJKRC079Z15M8NQ5IxT3yugeq13THqvOSIk50RuiRS2IC-FWXLDAErV30HCF-Lw52D8-OD1Pp2WhXUKsHtAX78_3-qfHWfphzd7PDve7R2lr5P04YUwa4WLDnXIdM0YdG5uTv8RCOc-0Y4FQ2V68y1rrAUcxrSiCJ6-dem1LfU3ikoi5dB25G0P1oir4BWq0qooBhqpA1wi7MfQSGNbSTGVIlAwlu6_k9WyMLQgUaWJVaGscs1ywxQGdjMKqaMS5aK1tWFBlq-33KmVgj9ThlTtg0Y2buP8L2BTx-XiNUJf9QMPPonOhnhBcJNeoaZrRiMwsjVVLmhxYUrD1MyZuRHI2HaPwKKuG2dDpfgyLuJKXZn5X9YbbpoPl6wdGO79__oJPWNTDpVIxcjGCiwy4loGx2ah8V5RFnmO6xqe-ZdKPmtgqCTXnBNr_FlTPiVFSu3SIV0DAjvgJH9RwUKvtvwgN6UJbCTbUdHSVVTfaW7vMl070u_fP1dicQvuJvdWOA1ljG6lfLfWZtRRrOXeJn6afrfNp0dvpS4m2Ya-x4HR61rjYCvvIF8kmk2_RCRWXvtj-AKpiukg=)

=== Execution

As a basis of the implementation, it has been taken into account:

[arabic]
. Schematron implementation of CVA files for validation from link:https://cranesoftwrights.github.io/resources/ubl/index.htm#cva2sch[CRANE SOFTWRIGHTS LTD]

image::https://kroki.io/pikchr/svg/eNq9VcuO2jAU3fsrrqJZDC1EiZPAgNpFGhW1El0xqrpAQiEY4k6wK9tTWPZb-mn9kl4nMIRXOjMS3USJnXvPOTnnOjcK3oPnUi7IXK4FIbE_AMM2Bpz7nGuYOPEYPo8nDsxSjc9cZMXjnOmBA8X3R21ITHfv__n1G76NR7DgBdNgJBiVCr2QarV7GSYkk4VU4G38Pk3CBBdSY-Fhxgq5htiHDtx2cKHtuV6LxEG9efI1tm0R41_9wn2_t3DruVHbNgvrzcbJp2c2655rRkb4nQouGCyUXEEcuKyk7rt-2_L3Wli-lJbLmxsFOUvnXCyBRhGum5wJwE3qRvVN_86rbTZWHm363mvb2kqT8-wBFdEDRWFNkefePU_QVeS8RkyqFFq296Z0DlPVsqaPSifRJr8NdiXnoroclIUnZfRSGRliGmzuwSkDNZPFfJsavUqL4uBapWypGGpY87nJUUa_ksGXuQH84PZpQtYc91w0BGM48u3Nlg5YDi1ShTnBKWOd7GdKdZYj-r270YUDVfHa1g79ykpLHHnvUk574cdejwzplakjvN5S75fUg-CQ-5IJpngm56yT4GXEtTnVQBs1BP9bQ_dIQyKFxvOOC6PpOMvZKjVKivN2BE9SojNaSKzQkSqIZbrKNFoCYE_oahzKAVAlXwwmfpx17fjaNqrovUP4AV_9kMo4Fh27l-A4034NvP-hO-x5iB00YQfVyXKEHrwEPdih0-gEnQzDa48RvTRGX5jW6ZJ19uZ1DFMrLlIj1amHYWMco2vHMbw4UlzLqX7SMNUPrGAGb_A_PEUVxj_VEjVpwUiEZyIRNsUxekkgwstx_AtlzId1[Code List Validation Execution files,width=650,height=250]
//image:CodeList_Validation_Execution_files.jpg[Code List Validation Execution files,width=600,height=210]
//[Edit this diagram](https://niolesk.top/#https://kroki.io/pikchr/svg/eNq9VcuO2jAU3fsrrqJZDC1EiZPAgNpFGhW1El0xqrpAQiEY4k6wK9tTWPZb-mn9kl4nMIRXOjMS3USJnXvPOTnnOjcK3oPnUi7IXK4FIbE_AMM2Bpz7nGuYOPEYPo8nDsxSjc9cZMXjnOmBA8X3R21ITHfv__n1G76NR7DgBdNgJBiVCr2QarV7GSYkk4VU4G38Pk3CBBdSY-Fhxgq5htiHDtx2cKHtuV6LxEG9efI1tm0R41_9wn2_t3DruVHbNgvrzcbJp2c2655rRkb4nQouGCyUXEEcuKyk7rt-2_L3Wli-lJbLmxsFOUvnXCyBRhGum5wJwE3qRvVN_86rbTZWHm363mvb2kqT8-wBFdEDRWFNkefePU_QVeS8RkyqFFq296Z0DlPVsqaPSifRJr8NdiXnoroclIUnZfRSGRliGmzuwSkDNZPFfJsavUqL4uBapWypGGpY87nJUUa_ksGXuQH84PZpQtYc91w0BGM48u3Nlg5YDi1ShTnBKWOd7GdKdZYj-r270YUDVfHa1g79ykpLHHnvUk574cdejwzplakjvN5S75fUg-CQ-5IJpngm56yT4GXEtTnVQBs1BP9bQ_dIQyKFxvOOC6PpOMvZKjVKivN2BE9SojNaSKzQkSqIZbrKNFoCYE_oahzKAVAlXwwmfpx17fjaNqrovUP4AV_9kMo4Fh27l-A4034NvP-hO-x5iB00YQfVyXKEHrwEPdih0-gEnQzDa48RvTRGX5jW6ZJ19uZ1DFMrLlIj1amHYWMco2vHMbw4UlzLqX7SMNUPrGAGb_A_PEUVxj_VEjVpwUiEZyIRNsUxekkgwstx_AtlzId1)

This example describes the execution of the validation process using the link:http://saxon.sourceforge.net/[Saxon library] to execute XSLT files and the XSLT provided as a basis:

image::https://kroki.io/pikchr/svg/eNq1lF9v2jAUxd_zKa5QH9Z1RIljQ0DaJJou2iaqSQVVe9iLCW6SLTiVYxU-fm_-NukYZB0IgRTuybm_Y_v6QsFHsEwSS8Pw7Sk8xImAgXc_G8AqTdaQbXiSdH6DNEkVrBIe_IZtvNYRvj55f6EgEnEYabBNB58MLXa6j5G1I5R-di3gGnzb4EqlW_SwckcdxRKGn4wZmUIQqyBHG-xxQh3C1H72hHjUy5Mk-OTf5B980o33uO3tkzr0wvtymtDHjTqhSQPGOqHpGUOP6tA_FvMjrKESQh4KvZ-enZHebehv50dX-po4zHEOBTB853TLAT-NbYw1U-abOyNmBkN4Z5nOB_xeGj6tW33jT_z_4Zt2WdGOYtsrbIfNCMNu7GzBaBWsijU-6Za86sU6veop47tUmr-4Guwfrc7C-Lgw9ZWkuBTD-qVB8MRJFkS4PktzlyVHzAoe3zGzyuxWZBkPxXARRGLDtUrli7MWahNLrlPV25g1xnfiMVV6Cl8X32FxfzfvFdLFkMZMKbzHy8F5UOkmx5Wg0_Is5jOUS0hXku9mKZGNxNkvoS0J3S9hLQnrSljFQlsso65kXElYLTGWGKhcFrs6W6s4LL7te_mPPSoHr5iFS2NJag_S24O1PWjbw-ntMS49hghRghhzTJPEUlR3oOJrsNnjrkpvm3Jbj7B9iWZhWpYjwdexDIEwhv_qCIcVS-NydsqSXZyIpmTa7eLEev3aFbR983J9uibetWffQJCkmYCVwE1YQ34iEJ4cgic1vGmxfvzuAf6_0rtvpncO0Y9e6Glx1VT05C307jF65x_pnwHqgeia[Execution of the validation process in code lists,width=650,height=300]
//image:Execution _validation process_codelists.jpg[Execution of the validation process in code lists,width=600,height=279]
//[Edit this diagram](https://niolesk.top/#https://kroki.io/pikchr/svg/eNq1lF9v2jAUxd_zKa5QH9Z1RIljQ0DaJJou2iaqSQVVe9iLCW6SLTiVYxU-fm_-NukYZB0IgRTuybm_Y_v6QsFHsEwSS8Pw7Sk8xImAgXc_G8AqTdaQbXiSdH6DNEkVrBIe_IZtvNYRvj55f6EgEnEYabBNB58MLXa6j5G1I5R-di3gGnzb4EqlW_SwckcdxRKGn4wZmUIQqyBHG-xxQh3C1H72hHjUy5Mk-OTf5B980o33uO3tkzr0wvtymtDHjTqhSQPGOqHpGUOP6tA_FvMjrKESQh4KvZ-enZHebehv50dX-po4zHEOBTB853TLAT-NbYw1U-abOyNmBkN4Z5nOB_xeGj6tW33jT_z_4Zt2WdGOYtsrbIfNCMNu7GzBaBWsijU-6Za86sU6veop47tUmr-4Guwfrc7C-Lgw9ZWkuBTD-qVB8MRJFkS4PktzlyVHzAoe3zGzyuxWZBkPxXARRGLDtUrli7MWahNLrlPV25g1xnfiMVV6Cl8X32FxfzfvFdLFkMZMKbzHy8F5UOkmx5Wg0_Is5jOUS0hXku9mKZGNxNkvoS0J3S9hLQnrSljFQlsso65kXElYLTGWGKhcFrs6W6s4LL7te_mPPSoHr5iFS2NJag_S24O1PWjbw-ntMS49hghRghhzTJPEUlR3oOJrsNnjrkpvm3Jbj7B9iWZhWpYjwdexDIEwhv_qCIcVS-NydsqSXZyIpmTa7eLEev3aFbR983J9uibetWffQJCkmYCVwE1YQ34iEJ4cgic1vGmxfvzuAf6_0rtvpncO0Y9e6Glx1VT05C307jF65x_pnwHqgeia)

== ESPD Validation Architecture

The validation of a ESPD XML has the following life-cycle:

image::https://kroki.io/mermaid/svg/eNqlkk1rwkAQhu_7K4aem0PMzUJpkjVioghaSg-9rNkRQ5cd2az0UPrfGzdrYyUExQSGvLPvMx9ht4q-yp0wFl45g-aJX76h3ok9jqGsTKnwEZTYoBrDQ_P-PDlT0pkMHbRE2blSg8IirHBPxjaEA9IB4H3N4U2oSgpbkT4RPOyQLZnPzp81CshATtWfezJQP9aa7HGk-lCWWNcf2tLFeNk1OBpDpo-eDv0Nkqiq2vZtOLplw9lAk2TVUz6_ayce3TJcMdBrjVpeFJ_fNdqio-VGBcdb-v-OMhZDEDxD4mLqIg8ZD5svWBZOT1yctmcjxkdnZzMvi6WTeZtsrRFjPDrzFl5679wnfTOfzU7Zlln8ApglA0Y=[ESPD Schematorn lyfe-cycle,width=450,height=750]
//image:ESPD_Schematorn_lyfe-cycle.jpg[ESPD Schematorn lyfe-cycle,width=370,height=436]
//[Edit this diagram](https://niolesk.top/#https://kroki.io/mermaid/svg/eNqlkk1rwkAQhu_7K4aem0PMzUJpkjVioghaSg-9rNkRQ5cd2az0UPrfGzdrYyUExQSGvLPvMx9ht4q-yp0wFl45g-aJX76h3ok9jqGsTKnwEZTYoBrDQ_P-PDlT0pkMHbRE2blSg8IirHBPxjaEA9IB4H3N4U2oSgpbkT4RPOyQLZnPzp81CshATtWfezJQP9aa7HGk-lCWWNcf2tLFeNk1OBpDpo-eDv0Nkqiq2vZtOLplw9lAk2TVUz6_ayce3TJcMdBrjVpeFJ_fNdqio-VGBcdb-v-OMhZDEDxD4mLqIg8ZD5svWBZOT1yctmcjxkdnZzMvi6WTeZtsrRFjPDrzFl5679wnfTOfzU7Zlln8ApglA0Y=)

[arabic]
. The validation of the XML starts by ensuring that the input XML follows the *structure defined by the XSD*: QualificationApplicationRequest.xsd XSD Schema or QualificationApplicationResponse.xsd XSD Schema. These schemas can be found under the folder ubl-2.3/xsdrt/maindoc (or the equivalent documented xsd folder).
[loweralpha]
.. If the validation of the structure is not successful, the process stops and sends the report with the list of errors.
.. If the validation of the structure is successful, the process continues with the code list validations and business rules. All errors found (if any) are listed in the report.
. Depending on the type of application (ESPD Request or ESPD Response), different types of validations are executed:

image::https://kroki.io/pikchr/svg/eNq9mM9zqkgQx-_8FVNuDroqBQNofFV7YEBPqXpZU7u1h3dBJHFqCfgAo--_35lh-DlDEjBrDimkx-5vf6Z7hL5LwB9AUyGOlN_AMU5xhuMIxM_AS5L4DHAEdvgF7OJLkCp33pEs1tUlVGx9943eBYm3B9bxAkbrp0cXbIOfpyDNRuxLfhzGCdAujmUhXQfPOAzJp7W7dA36KQNnvM8OQLd-v0vAIcAvhwxAcq1kwSWTOfQyQOJyv-cDzgJFQV1C0mMcpUEvJcS5ml9xNfQGv_yhnDExqGeuQg3AFIw11bRm2qSpuB6ZLEZtyTb0vwEfJ34YgOyA_X8b_zkUyqQlu5AQFRJSJmE211RjouzjcwSUfNfotxXbaJP558kFf3sh3nt0k0dgNP4LPcz_PJFbz9hnN-3jMeSXHP0cqoZ6SfeTEREgB7lBa8tdMpBUYxPlnFSXWe3qtRpo6sauRKOvoGM6pAy-gin6kCm6mmleHAOhGhzqQJZCbJqzDKZ5amXpxPsAPOA0S8l-kpBkU8D2FJL_Y00HtO7nPlkSkhXzN2ZW_TdvkvdAZ4abDXTcRobjPfEwZnnOiDI1mEyIrehGo6Mb6fJy26yiG6_STMmYJ5GM9Q4ZO8sSvDtlJAI6pTgK0nZA4MSvr-R4dR5qi9XUP_QnRdTxBuvFR1c1CZ_rlVNelsjLXrT7xfGSPY5IhWa_yhAQFGc9qJvRlgfowuKu1_ZmIW-RvliqshkgkHpbSPqoX_bp8ZbpowHpdymk7mT5L8VuYVVUHVq0N52E_Cwm9LFDKD6jWXzVwu0numYNN5q7-oqugfWu-R8yoPyWku65F-rnw0CsRsUoPRgNbCFYq6GhKqnLe0kdDeJAi_VWINBwEHKZ1KeMxOpTHfU9OwSJGNNs1CJf9JlOci3XWS--opOMDzppqHLKayXpIF1rl877EWhhttz3gDKwdYyqYnqrY68C2k6Sud6jaazK_2MS-6fktgDMWlUMFMk46DIOsM3h6Rj49AH53QjVoltiKOtgoEZGAUrOjf590O_4vA4CGtYM3UenrCOQ2BHr7-_wJd6p_XaZ17qgjzCWry7Ld0jlE-e3Kn00uPSlIhkHae0LL-2PSTD_WX9NloZovEjfEoZVFcJVShkR2fu9bnZWxjYOA2kMZrgpBLEiPimO5W1KfgugVk2JJDOhciDIUmlNiNLicC1HRLq6mCjoap9Uam3sRHwqCL-g-KJXe6TTTfqhAPrXHrBNWTxu5FTzOQqdZ0UzqlBNJ-ThirzmkaWTyhGbfDHymsq8eLv4LQA29HNB9MVwpqmGVX5nFxxwtGdjWH6HZcYmmzznl8T7VaQAWylweTy_qgZqiRW2omRqUvMa4XY-f4Uzrb-4fKL3nMSvrBRTkMXsgTYikMZ33pGOdGtrqCmtTGy11b3aElbbC7IRjaiLIuqy289S9HPf9nNf-Fl1-1mJfsjvY8sRvZPmNl2w6aUNCjZY2GiZNWyoiXbajXYqop12o22ubqNFTbTTbrRNP220qIl22o226UdAi0q0SECLSrRIQItKtPQQb9tKtvT0aNnMwsa25D9ratpK[Validation Process,width=600,height=650]
//image:Validation_Process.jpg[Validation Process,width=600,height=416]
//[Edit this diagram](https://niolesk.top/#https://kroki.io/pikchr/svg/eNq9mM9zqkgQx-_8FVNuDroqBQNofFV7YEBPqXpZU7u1h3dBJHFqCfgAo--_35lh-DlDEjBrDimkx-5vf6Z7hL5LwB9AUyGOlN_AMU5xhuMIxM_AS5L4DHAEdvgF7OJLkCp33pEs1tUlVGx9943eBYm3B9bxAkbrp0cXbIOfpyDNRuxLfhzGCdAujmUhXQfPOAzJp7W7dA36KQNnvM8OQLd-v0vAIcAvhwxAcq1kwSWTOfQyQOJyv-cDzgJFQV1C0mMcpUEvJcS5ml9xNfQGv_yhnDExqGeuQg3AFIw11bRm2qSpuB6ZLEZtyTb0vwEfJ34YgOyA_X8b_zkUyqQlu5AQFRJSJmE211RjouzjcwSUfNfotxXbaJP558kFf3sh3nt0k0dgNP4LPcz_PJFbz9hnN-3jMeSXHP0cqoZ6SfeTEREgB7lBa8tdMpBUYxPlnFSXWe3qtRpo6sauRKOvoGM6pAy-gin6kCm6mmleHAOhGhzqQJZCbJqzDKZ5amXpxPsAPOA0S8l-kpBkU8D2FJL_Y00HtO7nPlkSkhXzN2ZW_TdvkvdAZ4abDXTcRobjPfEwZnnOiDI1mEyIrehGo6Mb6fJy26yiG6_STMmYJ5GM9Q4ZO8sSvDtlJAI6pTgK0nZA4MSvr-R4dR5qi9XUP_QnRdTxBuvFR1c1CZ_rlVNelsjLXrT7xfGSPY5IhWa_yhAQFGc9qJvRlgfowuKu1_ZmIW-RvliqshkgkHpbSPqoX_bp8ZbpowHpdymk7mT5L8VuYVVUHVq0N52E_Cwm9LFDKD6jWXzVwu0numYNN5q7-oqugfWu-R8yoPyWku65F-rnw0CsRsUoPRgNbCFYq6GhKqnLe0kdDeJAi_VWINBwEHKZ1KeMxOpTHfU9OwSJGNNs1CJf9JlOci3XWS--opOMDzppqHLKayXpIF1rl877EWhhttz3gDKwdYyqYnqrY68C2k6Sud6jaazK_2MS-6fktgDMWlUMFMk46DIOsM3h6Rj49AH53QjVoltiKOtgoEZGAUrOjf590O_4vA4CGtYM3UenrCOQ2BHr7-_wJd6p_XaZ17qgjzCWry7Ld0jlE-e3Kn00uPSlIhkHae0LL-2PSTD_WX9NloZovEjfEoZVFcJVShkR2fu9bnZWxjYOA2kMZrgpBLEiPimO5W1KfgugVk2JJDOhciDIUmlNiNLicC1HRLq6mCjoap9Uam3sRHwqCL-g-KJXe6TTTfqhAPrXHrBNWTxu5FTzOQqdZ0UzqlBNJ-ThirzmkaWTyhGbfDHymsq8eLv4LQA29HNB9MVwpqmGVX5nFxxwtGdjWH6HZcYmmzznl8T7VaQAWylweTy_qgZqiRW2omRqUvMa4XY-f4Uzrb-4fKL3nMSvrBRTkMXsgTYikMZ33pGOdGtrqCmtTGy11b3aElbbC7IRjaiLIuqy289S9HPf9nNf-Fl1-1mJfsjvY8sRvZPmNl2w6aUNCjZY2GiZNWyoiXbajXYqop12o22ubqNFTbTTbrRNP220qIl22o226UdAi0q0SECLSrRIQItKtPQQb9tKtvT0aNnMwsa25D9ratpK)

=== ESPD Request

[arabic]
. *XSD Validation* against QualificationApplicationRequest-2.3.xsd
. *Code list validations*. These are common for both, Request and Response:
[loweralpha]
.. Validation of the code list values: 01 ESPD-codelist-values.cva
.. Validation of the identification of the code list: 01 ESPD Common CL Attributes.sch
. Business rules related to the *cardinality* of the schema, that cannot be controlled using the XSD: 02 ESPD Req Cardinality BR.sch
. Business rules used to validate the *criteria data structure*:
[loweralpha]
.. Validations common for Request and Response: 03 ESPD Common Criterion BR.sch
.. Validations specific for Request applications: 03 ESPD Req Criterion BR.sch
. *Other* business rules:
[loweralpha]
.. Other validations which are common to Request and Response applications, such as the mandatory use of the attribute schemeAgencyID for identifiers: 04 ESPD Common Other BR.sch
.. Specific business rules for Request applications, in this case, the validation of the correct value for cbc:CutomisationID element: 04 ESPD Req Other BR.sch
.. Business rules related to the procurer: 05 ESPD Req Procurer BR.sch
.. Specific business rules: 05 ESPD Req Specific BR.sch

=== ESPD Response

[arabic]
. *XSD Validation* against UBL-QualificationApplicationResponse-2.3.xsd
. *Code list validations*. These are common for both, Request and Response:
[loweralpha]
.. Validation of the code list values: 01 ESPD-codelist-values.cva
.. Validation of the identification of the code list: 01 ESPD Common CL Attributes.sch
. Business rules related to the *cardinality* of the schema, that cannot be controlled using the XSD: 02 ESPD Resp Cardinality BR.sch.sch
. Business rules used to validate the *criteria data structure*:
[loweralpha]
.. Validations common for Request and Response: 03 ESPD Common Criterion BR.sch
.. Validations specific for Response applications: 03 ESPD Resp Criterion BR.sch
. *Other* business rules:
[loweralpha]
.. Other validations which are common to Request and Response applications, such as the mandatory use of the attribute schemeAgencyID for identifiers: 04 ESPD Common Other BR.sch
.. Specific business rules for Response applications, in this case, the validation of the correct value for cbc:CutomisationID element: 04 ESPD Resp Other BR.sch
.. Business rules related to the economic operator: 05 ESPD Resp EO BR.sch
.. Response Specific business rules: 05 ESPD Resp Specific BR.sch
.. Specific business rules for economic operators registered in a pre-qualification system: 05 ESPD Resp Qualification BR.sch
.. Specific business rules depending on the role: 05 ESPD Resp Role BR.sch

== UUID Criterion Validation

Each Criterion is defined in e-Certis and must use the *Universally Unique Identifier (UUID)* supplied by e-Certis:

[arabic]
. These UUIDs are 'constant', meaning that they are maintained by DG GROW and need to be used compulsory as they were issued by DG GROW.
. The value of each UUID are defined in the spreadsheets:
[loweralpha]
.. link:{url-tree}/codelists/ESPD-criterion.xlsx[ESPD-criterion]

The UUIDs defined in the ESPDRequest or ESPDResponse are fixed for the following elements:

[cols=",",options="header",]
|===
|*Spreadsheet row* | *XSD Path*
|{CRITERION | cac:TenderingCriterion/cbc:ID
|{QUESTION_GROUP or {REQUIREMENT_GROUP | cac:TenderingCriterion/cac:TenderingCriterionPropertyGroup/cbc:ID
|{QUESTION_SUBGROUP or {REQUIREMENT_SUBGROUP | cac:SubsidiaryTenderingCriterionPropertyGroup/cbc:ID 
|{LEGISLATION | cac:TenderingCriterion/cac:Legislation/cbc:ID
|===

Every QUESTION_GROUP or QUESTION_SUBGROUP that has the same structure (meaning QUESTION or QUESTION_SUBGROUP), share the same UUID, as they are the same.

=== Tendering Criterion 

The validation of each criterion (cac:TenderingCriterion element) has the aims to check:

[arabic]
. cbc:ID, cbc:CriterionTypeCode, cbc:Name and cbc:Description are mandatory;
. cbc:ID values match with the ones supplied by e-Certis;
. cac:TenderingCriterionPropertyGroup structure matches with the QUESTION_GROUP or REQUIREMENT_GROUP (see Tendering Criterion Property Group and Subgroup section below).

=== Tendering Criterion Property Group and Subgroup

The same validations are executed for the first level group of properties and sub-groups of properties. The rules applied are:

[arabic]
. The cbc:ID and cbc:PropertyGroupTypeCode are mandatory elements in the corresponding cbc:TenderingCriterion;
. cac:SubsidiaryTenderingCriterionPropertyGroup matches with QUESTION_SUBGROUP or REQUIREMENT_SUBGROUP (for each property group, the same validations are applied); 
. cac:TenderingCriterionProperty structure matches with QUESTION or REQUIREMENT or CAPTION (see Tendering Criterion Property section below). 

=== Tendering Criterion Property 

The validation of Tendering Criterion Property (cac:TenderingCriterionProperty element) is checked as follows:

[arabic]
. cbc:TypeCode and cbc:ValueDataTypeCode are mandatory elements;
. cbc:ID and cbc:Description elements are mandatory, although their values are not validated;
. If cbc:TypeCode value is "CAPTION", cbc:ValueDataTypeCode value must be "NONE".  

=== Note. Replacement of UUID by XML Path Like ID 

From ESPD v4.0.0, UUIDs will be replaced by XML Path Like IDs in the data structure, except for the top level Exclusion Grounds and Selection Criteria elements.
For further details, see section, "Common Aspects for Criteria". 

=== Interoperability testbed

The European Commission (EC) link:https://ec.europa.eu/isa2/awards_en[ISA2 Programme] provides an link:https://joinup.ec.europa.eu/asset/itb/description[Interoperability Testbed] where Stakeholders can freely test these validation artefacts.

All the ESPD-EDM artefacts necessary to perform the validation are set up in the testbed. Thus developers and integrators can test the validity of the ESPD-Request and ESDP-Response XML instances by uploading the instances in the testbed and launching the validation.

Use this URL to upload and execute the validations: link:https://www.itb.ec.europa.eu/espd/upload[Upload].

include::partial$feedback.adoc[]
